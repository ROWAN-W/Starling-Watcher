{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\songe\\\\Documents\\\\Project\\\\SummerProject\\\\StarlingUI-frontend\\\\src\\\\components\\\\deployment-menu\\\\delete\\\\DeleteProject.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useContext } from 'react';\nimport axios from \"axios\";\nimport { ProjectContext } from '../../App';\nimport logo from '../../img/load.gif';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst PROJECT_URL = 'http://localhost:8080/design/projects';\nexport default function DeleteProject(props) {\n  _s();\n\n  const {\n    projects,\n    setProjects,\n    handleProjectSelect,\n    handleCurrentUser\n  } = useContext(ProjectContext);\n  const [result, setResult] = useState('');\n  const [savePending, setIsPending] = useState(false);\n  const [error, setError] = useState(null);\n  const [reLogin, setReLogin] = useState(false);\n  useEffect(() => {\n    if (props.trigger === true) {\n      handleProjectDelete();\n    }\n  }, [props.trigger]);\n  useEffect(() => {\n    //key friendly\n    window.addEventListener('keydown', keyOperation);\n    return () => {\n      window.removeEventListener('keydown', keyOperation);\n    };\n  }, []);\n\n  function keyOperation(e) {\n    if (e.key === 'Escape' || e.code === 'Escape') {\n      closeWindow();\n    }\n  }\n\n  function handleProjectDelete() {\n    if (props.selectedProject !== null) {\n      setIsPending(true);\n      console.log(\"delete project in project delete!\");\n      deleteToServer(props.selectedProject.id);\n    }\n  }\n\n  function deleteToServer(id) {\n    axios.delete(PROJECT_URL + '/' + id).then(data => {\n      setIsPending(false);\n      setError(null);\n      setResult(\"Your project has been successfully deleted\");\n      console.log(\"delete \" + PROJECT_URL + '/' + id);\n      console.log(data);\n      setProjects(projects.filter(project => project.id !== id));\n      handleProjectSelect(undefined); //close automatically\n\n      setTimeout(() => {\n        closeWindow();\n      }, 1300);\n    }).catch(err => {\n      console.log(err.message);\n      setIsPending(false);\n      setResult('');\n\n      if (err.response.status === 401) {\n        setError(\"Authentication is required. Please sign in again.\");\n        setReLogin(true);\n      } //delete this project on the front-end\n      else if (err.response.status === 403) {\n        setError(\"Invalid project ID. The project will be deleted automatically.\");\n        setProjects(projects.filter(project => project.id !== id));\n        handleProjectSelect(undefined);\n      } else {\n        setError(err.message);\n      }\n    });\n  }\n\n  function clearField() {\n    setResult('');\n    setIsPending(false);\n    setError(null);\n  }\n\n  function authenticateAgain() {\n    if (reLogin) {\n      handleCurrentUser(undefined);\n      setReLogin(false);\n    }\n  }\n\n  function closeWindow() {\n    if (!savePending) {\n      authenticateAgain();\n      clearField();\n      props.setTrigger(false);\n    }\n  }\n\n  function message() {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [savePending && /*#__PURE__*/_jsxDEV(\"h4\", {\n        className: \"wait-message\",\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          className: \"loading\",\n          src: logo,\n          alt: \"loading...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 58\n        }, this), \"Please wait...\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 29\n      }, this), error && /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"close\",\n        onClick: () => {\n          closeWindow();\n        },\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 23\n      }, this), error && /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"title-error\",\n        children: \"Delete Project Error\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 23\n      }, this), !error && result !== '' && /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"title-success\",\n        children: \"Delete in the database!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 39\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"content\",\n        children: error ? error : ''\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 13\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"key-hint\",\n        children: \"(Press ESC to leave)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 23\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"popup-footer normal\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn short\",\n          onClick: () => {\n            closeWindow();\n          },\n          children: \"OK\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true);\n  }\n\n  return props.trigger ? /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"popup-projects\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"popup\",\n      children: message()\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 122,\n    columnNumber: 9\n  }, this) : \"\";\n}\n\n_s(DeleteProject, \"RvP2aAp3HA2fML0IXyWfS3afo2U=\");\n\n_c = DeleteProject;\n\nvar _c;\n\n$RefreshReg$(_c, \"DeleteProject\");","map":{"version":3,"names":["React","useState","useEffect","useContext","axios","ProjectContext","logo","PROJECT_URL","DeleteProject","props","projects","setProjects","handleProjectSelect","handleCurrentUser","result","setResult","savePending","setIsPending","error","setError","reLogin","setReLogin","trigger","handleProjectDelete","window","addEventListener","keyOperation","removeEventListener","e","key","code","closeWindow","selectedProject","console","log","deleteToServer","id","delete","then","data","filter","project","undefined","setTimeout","catch","err","message","response","status","clearField","authenticateAgain","setTrigger"],"sources":["C:/Users/songe/Documents/Project/SummerProject/StarlingUI-frontend/src/components/deployment-menu/delete/DeleteProject.js"],"sourcesContent":["import React, { useState,useEffect, useContext } from 'react';\r\nimport axios from \"axios\";\r\nimport { ProjectContext } from '../../App';\r\nimport logo from '../../img/load.gif';\r\nconst PROJECT_URL = 'http://localhost:8080/design/projects';\r\n\r\nexport default function DeleteProject(props) {\r\n    \r\n    const {projects, setProjects, handleProjectSelect, handleCurrentUser} = useContext(ProjectContext);\r\n\r\n    const [result, setResult] = useState('');\r\n    const [savePending, setIsPending] = useState(false);\r\n    const [error, setError] = useState(null);\r\n    const [reLogin, setReLogin] = useState(false);\r\n\r\n    useEffect(()=>{\r\n        if(props.trigger===true){\r\n            handleProjectDelete();\r\n        }\r\n    },[props.trigger]);\r\n\r\n    useEffect(()=>{\r\n        //key friendly\r\n        window.addEventListener('keydown', keyOperation);\r\n            \r\n        return () => { \r\n          window.removeEventListener('keydown', keyOperation);\r\n        };\r\n      },[]);\r\n    \r\n      function keyOperation(e){\r\n        if(e.key==='Escape'||e.code==='Escape'){\r\n          closeWindow();\r\n        }\r\n      }\r\n\r\n    function handleProjectDelete(){\r\n        if(props.selectedProject!==null){\r\n            setIsPending(true);\r\n            console.log(\"delete project in project delete!\");\r\n            deleteToServer(props.selectedProject.id);\r\n        }\r\n    }\r\n\r\n    function deleteToServer(id){\r\n\r\n        axios\r\n        .delete(PROJECT_URL+'/'+id)\r\n        .then((data) => {\r\n            setIsPending(false);\r\n            setError(null);\r\n            setResult(\"Your project has been successfully deleted\");\r\n            console.log(\"delete \"+PROJECT_URL+'/'+id);\r\n            console.log(data);\r\n            setProjects(projects.filter(project=>project.id!==id));\r\n            handleProjectSelect(undefined);\r\n            //close automatically\r\n            setTimeout(() => {\r\n                closeWindow();\r\n            }, 1300)\r\n        })\r\n        .catch((err) => {\r\n            console.log(err.message);\r\n            setIsPending(false);\r\n            setResult('');\r\n            if(err.response.status===401){\r\n                setError(\"Authentication is required. Please sign in again.\");\r\n                setReLogin(true);\r\n            }\r\n            //delete this project on the front-end\r\n            else if(err.response.status===403){\r\n                setError(\"Invalid project ID. The project will be deleted automatically.\");\r\n                setProjects(projects.filter(project=>project.id!==id));\r\n                handleProjectSelect(undefined);\r\n            }\r\n            else{\r\n                setError(err.message);\r\n            }\r\n        });\r\n      }\r\n\r\n      function clearField(){\r\n        setResult('');\r\n        setIsPending(false);\r\n        setError(null);\r\n      }\r\n\r\n      function authenticateAgain(){\r\n        if(reLogin){\r\n          handleCurrentUser(undefined);\r\n          setReLogin(false);\r\n        }\r\n      }\r\n\r\n      function closeWindow(){\r\n        if(!savePending){\r\n          authenticateAgain();clearField();props.setTrigger(false);\r\n        }\r\n      }\r\n\r\n\r\n    function message(){\r\n        return(\r\n            <>\r\n            {savePending && <h4 className='wait-message'><img className=\"loading\" src={logo} alt=\"loading...\" />Please wait...</h4>}\r\n            {error && <button className='close' onClick={()=>{closeWindow()}}>&times;</button>}\r\n            {error && <h2 className='title-error'>Delete Project Error</h2>}\r\n            {!error && result!=='' && <h2 className='title-success'>Delete in the database!</h2>}\r\n            <div className='content'>{error? error: ''}</div>\r\n            {error && <div className='key-hint'>(Press ESC to leave)</div>}\r\n            {error && \r\n            <div className='popup-footer normal'>\r\n                <button className='btn short' onClick={()=>{closeWindow()}}>OK</button>\r\n            </div>}\r\n            \r\n            \r\n            </>\r\n        )\r\n    }\r\n    \r\n    return (props.trigger) ?(\r\n        <div className='popup-projects'>\r\n            <div className='popup'>\r\n                {message()}\r\n            </div>\r\n        </div>\r\n      ): \"\"\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}