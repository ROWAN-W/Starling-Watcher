{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\songe\\\\Documents\\\\Project\\\\SummerProject\\\\StarlingUI-frontend\\\\src\\\\components\\\\deployment-menu\\\\CreateProject.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState, useContext } from 'react';\nimport axios from \"axios\";\nimport { ProjectContext } from '../App';\nimport { v4 as uuidv4 } from 'uuid';\nimport logo from '../img/load.gif';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst PROJECT_URL = 'http://localhost:8080/design/projects';\nexport default function CreateProject(props) {\n  _s();\n\n  const {\n    projects,\n    currentUserID,\n    setProjects,\n    handleProjectSelect,\n    handleCurrentUser\n  } = useContext(ProjectContext);\n  const [result, setResult] = useState('');\n  const [savePending, setIsPending] = useState(false);\n  const [error, setError] = useState(null);\n  const [reLogin, setReLogin] = useState(false);\n  useEffect(() => {\n    if (props.trigger === true) {\n      handleProjectAdd();\n    }\n  }, [props.trigger]);\n\n  function handleProjectAdd() {\n    const masterId = uuidv4();\n    const number = projects.length + 1;\n    const newProject = {\n      id: \"\",\n      name: 'project-' + number,\n      dateModified: new Date().toLocaleDateString() + ' ' + new Date().toLocaleTimeString(),\n      lastModifiedBy: currentUserID,\n      saved: true,\n      ownerID: currentUserID,\n      memberIDs: [currentUserID],\n      config: [{\n        id: masterId,\n        name: 'design',\n        kind: 'master',\n        //can be empty\n        label: {\n          app: 'project-' + number,\n          platform: ''\n        },\n        containers: []\n      }],\n      mapping: [{\n        nodeID: masterId,\n        mappedDrones: []\n      }]\n    };\n    console.log(\"add project in create project!\");\n    setIsPending(true);\n    postToServer(newProject);\n  }\n\n  function postToServer(project) {\n    axios.post(PROJECT_URL, JSON.stringify(project), {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }).then(data => {\n      setIsPending(false);\n      setError(null);\n      setResult(\"Your project has been successfully created and saved\");\n      console.log(\"post \" + PROJECT_URL);\n      console.log(data.data.id);\n      project.id = data.data.id; //id from db {\"id\": \"62c04445cda4856fc0226778\"}\n\n      setProjects([...projects, project]);\n      handleProjectSelect(data.data.id);\n    }).catch(err => {\n      console.log(err.message);\n      setIsPending(false);\n      setResult('');\n\n      if (err.response.status === 401) {\n        setError(\"Authentication is required. Please sign in again.\");\n        setReLogin(true);\n      } else if (err.response.status === 403) {\n        setError(\"Invalid project structure. Please try again.\");\n      } else {\n        setError(err.message);\n      }\n    });\n  }\n\n  function clearField() {\n    setResult('');\n    setIsPending(false);\n    setError(null);\n  }\n\n  function authenticateAgain() {\n    if (reLogin) {\n      handleCurrentUser(undefined);\n      setReLogin(false);\n    }\n  }\n\n  function message() {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [savePending && /*#__PURE__*/_jsxDEV(\"h4\", {\n        className: \"wait-message\",\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          className: \"loading\",\n          src: logo,\n          alt: \"loading...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 56\n        }, this), \"Please wait...\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 27\n      }, this), !savePending && /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"close\",\n        onClick: () => {\n          props.setTrigger(false);\n          clearField();\n          authenticateAgain();\n        },\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 28\n      }, this), error && /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"title-error\",\n        children: \"Create Project Error\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 21\n      }, this), !error && result !== '' && /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"title-success\",\n        children: \"Success!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 37\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"content\",\n        children: error ? error : result\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 11\n      }, this), !savePending && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"popup-footer normal\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn short\",\n          onClick: () => {\n            props.setTrigger(false);\n            clearField();\n            authenticateAgain();\n          },\n          children: \"OK\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true);\n  }\n\n  return props.trigger ? /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"popup-projects\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"popup\",\n      children: message()\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 130,\n    columnNumber: 9\n  }, this) : \"\";\n} //\n\n_s(CreateProject, \"TB0SD1toPVzIPfHSV07TuydZKnc=\");\n\n_c = CreateProject;\n\nvar _c;\n\n$RefreshReg$(_c, \"CreateProject\");","map":{"version":3,"names":["React","useEffect","useState","useContext","axios","ProjectContext","v4","uuidv4","logo","PROJECT_URL","CreateProject","props","projects","currentUserID","setProjects","handleProjectSelect","handleCurrentUser","result","setResult","savePending","setIsPending","error","setError","reLogin","setReLogin","trigger","handleProjectAdd","masterId","number","length","newProject","id","name","dateModified","Date","toLocaleDateString","toLocaleTimeString","lastModifiedBy","saved","ownerID","memberIDs","config","kind","label","app","platform","containers","mapping","nodeID","mappedDrones","console","log","postToServer","project","post","JSON","stringify","headers","then","data","catch","err","message","response","status","clearField","authenticateAgain","undefined","setTrigger"],"sources":["C:/Users/songe/Documents/Project/SummerProject/StarlingUI-frontend/src/components/deployment-menu/CreateProject.js"],"sourcesContent":["import React, { useEffect, useState, useContext } from 'react';\r\nimport axios from \"axios\";\r\nimport { ProjectContext } from '../App';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport logo from '../img/load.gif';\r\nconst PROJECT_URL = 'http://localhost:8080/design/projects';\r\n\r\nexport default function CreateProject(props) {\r\n    \r\n    const {projects, currentUserID, setProjects, handleProjectSelect,handleCurrentUser} = useContext(ProjectContext);\r\n\r\n    const [result, setResult] = useState('');\r\n    const [savePending, setIsPending] = useState(false);\r\n    const [error, setError] = useState(null);\r\n    const [reLogin, setReLogin] = useState(false);\r\n\r\n    useEffect(()=>{\r\n        if(props.trigger===true){\r\n            handleProjectAdd();\r\n        }\r\n    },[props.trigger]);\r\n\r\n    function handleProjectAdd(){  \r\n        const masterId = uuidv4();\r\n        const number = projects.length+1;\r\n\r\n        const newProject = {\r\n        id: \"\",\r\n        name: 'project-'+number,\r\n        dateModified: new Date().toLocaleDateString()+' '+new Date().toLocaleTimeString(),\r\n        lastModifiedBy: currentUserID,\r\n        saved: true,\r\n        ownerID: currentUserID,\r\n        memberIDs: [currentUserID],\r\n        config:[\r\n          {\r\n            id:masterId,\r\n            name: 'design',\r\n            kind: 'master',\r\n            //can be empty\r\n            label: \r\n              {\r\n                app: 'project-'+number,\r\n                platform: ''\r\n              }\r\n            ,\r\n            containers:[]    \r\n          },\r\n        ],\r\n        mapping:[\r\n          {\r\n            nodeID: masterId,\r\n            mappedDrones: []\r\n          }\r\n        ]\r\n      }\r\n        console.log(\"add project in create project!\");\r\n        setIsPending(true);\r\n        postToServer(newProject);\r\n        }\r\n      \r\n      function postToServer(project){\r\n\r\n        axios\r\n        .post(PROJECT_URL, \r\n          JSON.stringify(project),\r\n              {\r\n                  headers: { \r\n                      'Content-Type': 'application/json' ,\r\n                  },\r\n              }, \r\n        )\r\n        .then((data) => {\r\n          setIsPending(false);\r\n          setError(null);\r\n          setResult(\"Your project has been successfully created and saved\");\r\n          console.log(\"post \"+PROJECT_URL);\r\n          console.log(data.data.id);\r\n          project.id = data.data.id; //id from db {\"id\": \"62c04445cda4856fc0226778\"}\r\n          setProjects([...projects,project]);\r\n          handleProjectSelect(data.data.id); \r\n        })\r\n        .catch((err) => {\r\n          console.log(err.message);\r\n          setIsPending(false);\r\n          setResult('');\r\n          if(err.response.status===401){\r\n              setError(\"Authentication is required. Please sign in again.\");\r\n              setReLogin(true);\r\n          }\r\n          else if(err.response.status===403){\r\n            setError(\"Invalid project structure. Please try again.\");\r\n          }\r\n          else{\r\n              setError(err.message);\r\n          }\r\n        });\r\n      }\r\n\r\n      function clearField(){\r\n        setResult('');\r\n        setIsPending(false);\r\n        setError(null);\r\n      }\r\n\r\n      function authenticateAgain(){\r\n        if(reLogin){\r\n          handleCurrentUser(undefined);\r\n          setReLogin(false);\r\n        }\r\n      }\r\n\r\n    function message(){\r\n        return(\r\n        <>\r\n          {savePending && <h4 className='wait-message'><img className=\"loading\" src={logo} alt=\"loading...\" />Please wait...</h4>}\r\n          {!savePending && <button className='close' onClick={()=>{props.setTrigger(false);clearField();authenticateAgain()}}>&times;</button>}\r\n          {error && <h2 className='title-error'>Create Project Error</h2>}\r\n          {!error && result!=='' && <h2 className='title-success'>Success!</h2>}\r\n          <div className='content'>{error? error: result}</div>\r\n          {!savePending && \r\n          <div className='popup-footer normal'>\r\n            <button className='btn short' onClick={()=>{props.setTrigger(false);clearField();authenticateAgain()}}>OK</button>\r\n          </div>}\r\n        </>\r\n        )\r\n    }\r\n    \r\n    return (props.trigger) ?(\r\n        <div className='popup-projects'>\r\n            <div className='popup'>\r\n                {message()}\r\n            </div>\r\n        </div>\r\n      ): \"\"\r\n}\r\n//"],"mappings":"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"},"metadata":{},"sourceType":"module"}