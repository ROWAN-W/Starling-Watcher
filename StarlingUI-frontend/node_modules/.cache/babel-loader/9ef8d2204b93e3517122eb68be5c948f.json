{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\songe\\\\Documents\\\\Project\\\\SummerProject\\\\StarlingUI-frontend\\\\src\\\\components\\\\deployment-menu\\\\save\\\\SaveMessage.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState, useContext } from 'react';\nimport axios from \"axios\";\nimport { ProjectContext } from '../../App';\nimport logo from '../../img/load.gif';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst PROJECT_URL = 'http://localhost:8080/design/projects';\nexport default function SaveMessage(props) {\n  _s();\n\n  const {\n    projects,\n    currentUserID,\n    handleCurrentUser,\n    setProjects,\n    handleProjectSelect\n  } = useContext(ProjectContext);\n  const [result, setResult] = useState('');\n  const [savePending, setIsPending] = useState(false);\n  const [dateModified, setDateModified] = useState();\n  const [lastModifiedBy, setLastModifiedBy] = useState();\n  const [error, setError] = useState(null);\n  const [reLogin, setReLogin] = useState(false);\n  useEffect(() => {\n    if (props.trigger === true) {\n      //data before saving\n      console.log(\"data before saving\");\n      console.log(props.selectedProject.dateModified);\n      console.log(props.selectedProject.lastModifiedBy);\n      setDateModified(props.selectedProject.dateModified);\n      setLastModifiedBy(props.selectedProject.lastModifiedBy);\n      handleProjectSave();\n    }\n  }, [props.trigger]);\n  /*\r\n      * contain at most 63 characters\r\n      * contain only lowercase alphanumeric characters or '-'\r\n      * start with an alphanumeric character\r\n      * end with an alphanumeric character\r\n   */\n\n  function handleProjectSave() {\n    if (props.selectedProject.saved === false) {\n      setIsPending(true);\n      props.selectedProject.saved = true;\n      let today = new Date();\n      props.selectedProject.dateModified = today.toLocaleDateString() + ' ' + today.toLocaleTimeString();\n      props.selectedProject.lastModifiedBy = currentUserID;\n      putToServer(props.selectedProject.id, props.selectedProject);\n    } else {\n      console.log(\"already saved\");\n      setResult(\"The project is already saved\");\n    }\n  }\n\n  function putToServer(id, project) {\n    axios.put(PROJECT_URL + '/' + id, JSON.stringify(project), {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }).then(data => {\n      setIsPending(false);\n      setError(null);\n      setResult(\"Your changes have been successfully saved\");\n      console.log(\"put \" + PROJECT_URL + '/' + id);\n      console.log(data);\n    }).catch(err => {\n      console.log(err.message);\n      setIsPending(false);\n      setResult(''); //recover old data\n\n      props.selectedProject.saved = false;\n      props.selectedProject.dateModified = dateModified;\n      props.selectedProject.lastModifiedBy = lastModifiedBy;\n\n      if (err.response.status === 401) {\n        setError(\"Authentication is required. Please sign in again.\");\n        setReLogin(true);\n      } //delete this project on the front-end\n      else if (err.response.status === 403) {\n        setError(\"Invalid project structure or ID. The project will be deleted automatically.\");\n        setProjects(projects.filter(project => project.id !== id));\n        handleProjectSelect(undefined);\n      } else {\n        setError(err.message);\n      }\n    });\n  }\n\n  function clearField() {\n    setResult('');\n    setIsPending(false);\n    setError(null);\n  }\n\n  function authenticateAgain() {\n    if (reLogin) {\n      handleCurrentUser(undefined);\n      setReLogin(false);\n    }\n  }\n\n  function message() {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [savePending && /*#__PURE__*/_jsxDEV(\"h4\", {\n        className: \"wait-message\",\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          className: \"loading\",\n          src: logo,\n          alt: \"loading...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 58\n        }, this), \"Please wait...\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 29\n      }, this), !savePending && /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"close\",\n        onClick: () => {\n          props.setTrigger(false);\n          clearField();\n          authenticateAgain();\n        },\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 30\n      }, this), error && /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"title-error\",\n        children: \"Save Project Error\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 23\n      }, this), !error && result !== '' && /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"title-success\",\n        children: \"Success!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 39\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"content\",\n        children: error ? error : result\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 13\n      }, this), !savePending && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"popup-footer normal\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn short\",\n          onClick: () => {\n            props.setTrigger(false);\n            clearField();\n            authenticateAgain();\n          },\n          children: \"OK\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true);\n  }\n\n  return props.trigger ? /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"popup-projects\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"popup\",\n      children: message()\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 127,\n    columnNumber: 9\n  }, this) : \"\";\n}\n\n_s(SaveMessage, \"y+imlMd+wT/7kWvUnnYAM356wHA=\");\n\n_c = SaveMessage;\n\nvar _c;\n\n$RefreshReg$(_c, \"SaveMessage\");","map":{"version":3,"names":["React","useEffect","useState","useContext","axios","ProjectContext","logo","PROJECT_URL","SaveMessage","props","projects","currentUserID","handleCurrentUser","setProjects","handleProjectSelect","result","setResult","savePending","setIsPending","dateModified","setDateModified","lastModifiedBy","setLastModifiedBy","error","setError","reLogin","setReLogin","trigger","console","log","selectedProject","handleProjectSave","saved","today","Date","toLocaleDateString","toLocaleTimeString","putToServer","id","project","put","JSON","stringify","headers","then","data","catch","err","message","response","status","filter","undefined","clearField","authenticateAgain","setTrigger"],"sources":["C:/Users/songe/Documents/Project/SummerProject/StarlingUI-frontend/src/components/deployment-menu/save/SaveMessage.js"],"sourcesContent":["import React, { useEffect, useState, useContext } from 'react';\r\nimport axios from \"axios\";\r\nimport { ProjectContext } from '../../App';\r\nimport logo from '../../img/load.gif';\r\nconst PROJECT_URL = 'http://localhost:8080/design/projects';\r\n\r\nexport default function SaveMessage(props) {\r\n\r\n    const {projects, currentUserID, handleCurrentUser, setProjects, handleProjectSelect} = useContext(ProjectContext);\r\n\r\n    const [result, setResult] = useState('');\r\n    const [savePending, setIsPending] = useState(false);\r\n    const [dateModified, setDateModified] = useState();\r\n    const [lastModifiedBy,setLastModifiedBy] = useState();\r\n    const [error, setError] = useState(null);\r\n    const [reLogin, setReLogin] = useState(false);\r\n\r\n    useEffect(()=>{\r\n        if(props.trigger===true){\r\n            //data before saving\r\n            console.log(\"data before saving\");\r\n            console.log(props.selectedProject.dateModified);\r\n            console.log(props.selectedProject.lastModifiedBy);\r\n            setDateModified(props.selectedProject.dateModified);\r\n            setLastModifiedBy(props.selectedProject.lastModifiedBy);\r\n            handleProjectSave();\r\n        }\r\n    },[props.trigger]);\r\n\r\n    /*\r\n        * contain at most 63 characters\r\n        * contain only lowercase alphanumeric characters or '-'\r\n        * start with an alphanumeric character\r\n        * end with an alphanumeric character\r\n     */\r\n\r\n      function handleProjectSave(){\r\n        if(props.selectedProject.saved===false){\r\n          setIsPending(true);\r\n          \r\n          props.selectedProject.saved=true;\r\n          let today = new Date();\r\n          props.selectedProject.dateModified = today.toLocaleDateString()+' '+today.toLocaleTimeString();\r\n          props.selectedProject.lastModifiedBy = currentUserID;\r\n\r\n          putToServer(props.selectedProject.id,props.selectedProject);\r\n        }\r\n        else{\r\n          console.log(\"already saved\");\r\n          setResult(\"The project is already saved\");\r\n        }\r\n    }\r\n    \r\n      function putToServer(id,project){\r\n\r\n        axios\r\n        .put(PROJECT_URL+'/'+id, \r\n            JSON.stringify(project),\r\n            {\r\n                headers: { \r\n                    'Content-Type': 'application/json' ,\r\n                },\r\n            }, \r\n        )\r\n        .then((data) => {\r\n            setIsPending(false);\r\n            setError(null);\r\n            setResult(\"Your changes have been successfully saved\"); \r\n            console.log(\"put \"+PROJECT_URL+'/'+id);\r\n            console.log(data);\r\n        })\r\n        .catch((err) => {\r\n            console.log(err.message);\r\n            setIsPending(false);\r\n            setResult('');\r\n            //recover old data\r\n            props.selectedProject.saved=false;\r\n            props.selectedProject.dateModified = dateModified;\r\n            props.selectedProject.lastModifiedBy = lastModifiedBy;   \r\n            if(err.response.status===401){\r\n                setError(\"Authentication is required. Please sign in again.\");\r\n                setReLogin(true);\r\n            }\r\n            //delete this project on the front-end\r\n            else if(err.response.status===403){\r\n              setError(\"Invalid project structure or ID. The project will be deleted automatically.\");\r\n              setProjects(projects.filter(project=>project.id!==id));\r\n              handleProjectSelect(undefined);\r\n            }\r\n            else{\r\n                setError(err.message);\r\n            }\r\n        });\r\n        \r\n      }\r\n\r\n      function clearField(){\r\n        setResult('');\r\n        setIsPending(false);\r\n        setError(null);\r\n      }\r\n\r\n      function authenticateAgain(){\r\n        if(reLogin){\r\n          handleCurrentUser(undefined);\r\n          setReLogin(false);\r\n        }\r\n      }\r\n\r\n    function message(){\r\n        return(\r\n            <>\r\n            {savePending && <h4 className='wait-message'><img className=\"loading\" src={logo} alt=\"loading...\" />Please wait...</h4>}\r\n            {!savePending && <button className='close' onClick={()=>{props.setTrigger(false);clearField();authenticateAgain()}}>&times;</button>}\r\n            {error && <h2 className='title-error'>Save Project Error</h2>}\r\n            {!error && result!=='' && <h2 className='title-success'>Success!</h2>}\r\n            <div className='content'>{error? error: result}</div>\r\n            {!savePending && \r\n            <div className='popup-footer normal'>\r\n            <button className='btn short' onClick={()=>{props.setTrigger(false);clearField();authenticateAgain()}}>OK</button>\r\n            </div>}   \r\n            </>\r\n        )\r\n    }\r\n    \r\n    return (props.trigger) ?(\r\n        <div className='popup-projects'>\r\n            <div className='popup'>\r\n                {message()}\r\n            </div>\r\n        </div>\r\n      ): \"\"\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}